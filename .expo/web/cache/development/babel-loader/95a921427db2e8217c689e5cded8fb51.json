{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport * as authService from \"../services/auth\";\nimport { APP_STORAGE_TOKEN } from \"../constants/user.constants\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nvar UserContext = createContext({\n  user: null\n});\nexport var UserProvider = function UserProvider(_ref) {\n  var children = _ref.children;\n\n  var _useState = useState({\n    name: {}\n  }),\n      _useState2 = _slicedToArray(_useState, 2),\n      user = _useState2[0],\n      setUser = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      token = _useState4[0],\n      setToken = _useState4[1];\n\n  var performLogin = function performLogin(_ref2) {\n    var email = _ref2.email,\n        password = _ref2.password;\n\n    var f = function f() {\n      var token, _user;\n\n      return _regeneratorRuntime.async(function f$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(authService.createToken({\n                email: email,\n                password: password\n              }));\n\n            case 2:\n              token = _context.sent;\n\n              if (!token) {\n                _context.next = 19;\n                break;\n              }\n\n              _context.prev = 4;\n              _context.next = 7;\n              return _regeneratorRuntime.awrap(AsyncStorage.setItem(APP_STORAGE_TOKEN, token));\n\n            case 7:\n              authService.updateToken(token);\n              setToken(token);\n              _context.next = 11;\n              return _regeneratorRuntime.awrap(authService.getMe());\n\n            case 11:\n              _user = _context.sent;\n              setUser(_user);\n              return _context.abrupt(\"return\", false);\n\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](4);\n              return _context.abrupt(\"return\", false);\n\n            case 19:\n              return _context.abrupt(\"return\", false);\n\n            case 20:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[4, 16]], Promise);\n    };\n\n    f();\n  };\n\n  var performLogout = function performLogout() {\n    AsyncStorage.clear().then(function () {\n      setUser({\n        name: \"\"\n      });\n      setToken(null);\n    });\n  };\n\n  useEffect(function () {\n    var f = function f() {\n      var token;\n      return _regeneratorRuntime.async(function f$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return _regeneratorRuntime.awrap(AsyncStorage.getItem(APP_STORAGE_TOKEN));\n\n            case 2:\n              token = _context2.sent;\n              authService.updateToken(token);\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    };\n\n    f();\n  }, []);\n  return _jsx(UserContext.Provider, {\n    value: {\n      performLogin: performLogin,\n      user: user,\n      token: token,\n      setToken: setToken,\n      performLogout: performLogout\n    },\n    children: children\n  });\n};\nexport function useAuth() {\n  var context = useContext(UserContext);\n  return context;\n}","map":{"version":3,"sources":["/home/dan/danXCode/mobile/enxutank-mobile/context/auth.context.js"],"names":["createContext","useContext","useEffect","useState","authService","APP_STORAGE_TOKEN","AsyncStorage","UserContext","user","UserProvider","children","name","setUser","token","setToken","performLogin","email","password","f","createToken","setItem","updateToken","getMe","performLogout","clear","then","getItem","useAuth","context"],"mappings":";;AAAA,SAASA,aAAT,EAAwBC,UAAxB,EAAoCC,SAApC,EAA+CC,QAA/C,QAA+D,OAA/D;AACA,OAAO,KAAKC,WAAZ;AACA,SAASC,iBAAT;AACA,OAAOC,YAAP,MAAyB,2CAAzB;;AAEA,IAAMC,WAAW,GAAGP,aAAa,CAAC;AAAEQ,EAAAA,IAAI,EAAE;AAAR,CAAD,CAAjC;AAEA,OAAO,IAAMC,YAAY,GAAG,SAAfA,YAAe,OAAkB;AAAA,MAAfC,QAAe,QAAfA,QAAe;;AAC1C,kBAAwBP,QAAQ,CAAC;AAAEQ,IAAAA,IAAI,EAAE;AAAR,GAAD,CAAhC;AAAA;AAAA,MAAOH,IAAP;AAAA,MAAaI,OAAb;;AACA,mBAA0BT,QAAQ,CAAC,IAAD,CAAlC;AAAA;AAAA,MAAOU,KAAP;AAAA,MAAcC,QAAd;;AAEA,MAAMC,YAAY,GAAG,SAAfA,YAAe,QAAyB;AAAA,QAAtBC,KAAsB,SAAtBA,KAAsB;AAAA,QAAfC,QAAe,SAAfA,QAAe;;AAC1C,QAAMC,CAAC,GAAG,SAAJA,CAAI;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACcd,WAAW,CAACe,WAAZ,CAAwB;AAAEH,gBAAAA,KAAK,EAALA,KAAF;AAASC,gBAAAA,QAAQ,EAARA;AAAT,eAAxB,CADd;;AAAA;AACAJ,cAAAA,KADA;;AAAA,mBAEFA,KAFE;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,+CAIQP,YAAY,CAACc,OAAb,CAAqBf,iBAArB,EAAwCQ,KAAxC,CAJR;;AAAA;AAKET,cAAAA,WAAW,CAACiB,WAAZ,CAAwBR,KAAxB;AACAC,cAAAA,QAAQ,CAACD,KAAD,CAAR;AANF;AAAA,+CAOqBT,WAAW,CAACkB,KAAZ,EAPrB;;AAAA;AAOQd,cAAAA,KAPR;AAQEI,cAAAA,OAAO,CAACJ,KAAD,CAAP;AARF,+CASS,KATT;;AAAA;AAAA;AAAA;AAAA,+CAYS,KAZT;;AAAA;AAAA,+CAeC,KAfD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAV;;AAkBAU,IAAAA,CAAC;AACJ,GApBD;;AAsBA,MAAMK,aAAa,GAAG,SAAhBA,aAAgB,GAAM;AACxBjB,IAAAA,YAAY,CAACkB,KAAb,GAAqBC,IAArB,CAA0B,YAAM;AAC5Bb,MAAAA,OAAO,CAAC;AAAED,QAAAA,IAAI,EAAE;AAAR,OAAD,CAAP;AACAG,MAAAA,QAAQ,CAAC,IAAD,CAAR;AACH,KAHD;AAIH,GALD;;AAOAZ,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAMgB,CAAC,GAAG,SAAJA,CAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+CACcZ,YAAY,CAACoB,OAAb,CAAqBrB,iBAArB,CADd;;AAAA;AACAQ,cAAAA,KADA;AAENT,cAAAA,WAAW,CAACiB,WAAZ,CAAwBR,KAAxB;;AAFM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAV;;AAIAK,IAAAA,CAAC;AACJ,GANQ,EAMN,EANM,CAAT;AAQA,SACI,KAAC,WAAD,CAAa,QAAb;AACI,IAAA,KAAK,EAAE;AACHH,MAAAA,YAAY,EAAZA,YADG;AAEHP,MAAAA,IAAI,EAAJA,IAFG;AAGHK,MAAAA,KAAK,EAALA,KAHG;AAIHC,MAAAA,QAAQ,EAARA,QAJG;AAKHS,MAAAA,aAAa,EAAbA;AALG,KADX;AAAA,cASKb;AATL,IADJ;AAaH,CAtDM;AAwDP,OAAO,SAASiB,OAAT,GAAmB;AACtB,MAAMC,OAAO,GAAG3B,UAAU,CAACM,WAAD,CAA1B;AACA,SAAOqB,OAAP;AACH","sourcesContent":["import { createContext, useContext, useEffect, useState } from \"react\";\nimport * as authService from '../services/auth';\nimport { APP_STORAGE_TOKEN } from '../constants/user.constants';\nimport AsyncStorage from '@react-native-async-storage/async-storage';\n\nconst UserContext = createContext({ user: null })\n\nexport const UserProvider = ({ children }) => {\n    const [user, setUser] = useState({ name: {} })\n    const [token, setToken] = useState(null)\n\n    const performLogin = ({ email, password }) => {\n        const f = async () => {\n            const token = await authService.createToken({ email, password })\n            if (token) {\n                try {\n                    await AsyncStorage.setItem(APP_STORAGE_TOKEN, token);\n                    authService.updateToken(token);\n                    setToken(token)\n                    const user = await authService.getMe()\n                    setUser(user)\n                    return false\n                }\n                catch (e) {\n                    return false\n                }\n            }\n            return false\n\n        }\n        f()\n    }\n\n    const performLogout = () => {\n        AsyncStorage.clear().then(() => {\n            setUser({ name: \"\" });\n            setToken(null);\n        });\n    }\n\n    useEffect(() => {\n        const f = async () => {\n            const token = await AsyncStorage.getItem(APP_STORAGE_TOKEN)\n            authService.updateToken(token)\n        }\n        f();\n    }, [])\n\n    return (\n        <UserContext.Provider\n            value={{\n                performLogin,\n                user,\n                token,\n                setToken,\n                performLogout,\n            }}\n        >\n            {children}\n        </UserContext.Provider>\n    );\n}\n\nexport function useAuth() {\n    const context = useContext(UserContext);\n    return context;\n}"]},"metadata":{},"sourceType":"module"}